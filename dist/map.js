"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var weapons=[{cssClass:"snowball",damage:5},{cssClass:"fish",damage:10},{cssClass:"smallStone",damage:15},{cssClass:"bigStone",damage:20}],pickableWeapons=weapons.filter(function(e){return 5<e.damage}),defaultWeapon=weapons.find(function(e){return"snowball"==e.cssClass}),allMapSquares=document.getElementsByClassName("mapSquare"),mapContainer=document.getElementById("map-container"),initialHealthStatus=100,dimmedSquareClass="dimmedSquare",Player=function e(a,t){var n=this;_classCallCheck(this,e),this.cssClass=a,this.statboxId=t,this.isActive=!1,this.position=null,this.healthPoints=initialHealthStatus,this.Weapon=defaultWeapon,this.defence=1,this.positionArray=function(){var e=n.position.id.split("-");return e[0]=parseInt(e[0]),e[1]=parseInt(e[1]),e}},playerOne=new Player("playerOne","statboxOne"),playerTwo=new Player("playerTwo","statboxTwo"),activePlayer=function(){return 1==playerOne.isActive?playerOne:1==playerTwo.isActive?playerTwo:void 0};function randomPositionOnMap(){var e=Math.floor(Math.random()*allMapSquares.length);return allMapSquares[e]}function generateDimmedSquares(){for(var e=0;e<15;){var a=randomPositionOnMap();"mapSquare"===a.className&&(a.classList.add("dimmedSquare"),e++)}}function generatePlayersPosition(e){for(var a=0;a<1;){var t=randomPositionOnMap();"mapSquare"===t.className&&(t.classList.add(e.cssClass),a++),e.position=document.getElementsByClassName(e.cssClass)[0]}}function generateWeapons(){var e=!0,a=!1,t=void 0;try{for(var n,s=pickableWeapons[Symbol.iterator]();!(e=(n=s.next()).done);e=!0)for(var l=n.value,o=0;o<2;){var i=randomPositionOnMap();"mapSquare"===i.className&&(i.classList.add(l.cssClass),o++)}}catch(e){a=!0,t=e}finally{try{e||null==s.return||s.return()}finally{if(a)throw t}}}function drawMapGrid(e){for(var a=0;a<e;a++){var t=document.createElement("div");t.className="mapGridRow",mapGrid.appendChild(t);for(var n=0;n<e;n++){var s=document.createElement("div");s.className="mapSquare",s.id="".concat([a+1],"-").concat([n+1]),t.appendChild(s)}}generateDimmedSquares(),generatePlayersPosition(playerOne),playerOne.isActive=!0,checkAvailableSquares(playerOne),generatePlayersPosition(playerTwo),generateWeapons()}drawMapGrid(12),statboxFunction(playerOne),statboxFunction(playerTwo);var availableList=document.getElementsByClassName("availableSquare");function statboxFunction(e){var a=document.createElement("p"),t=document.createTextNode("Health: ".concat(e.healthPoints));a.appendChild(t),document.getElementById("".concat(e.statboxId)).appendChild(a);var n=document.createElement("p"),s=document.createTextNode("Weapon: ".concat(e.Weapon.cssClass));n.appendChild(s),document.getElementById("".concat(e.statboxId)).appendChild(n);var l=document.createElement("p"),o=document.createTextNode("Damage: ".concat(e.Weapon.damage));l.appendChild(o),document.getElementById("".concat(e.statboxId)).appendChild(l);var i=document.createElement("p"),c=document.createTextNode("Position: ".concat(e.position.id));i.appendChild(c),document.getElementById("".concat(e.statboxId)).appendChild(i)}function checkAvailableSquares(e){function a(e,a,t){for(var n=e.positionArray()[0],s=e.positionArray()[1],l=0;l<3;l++){1===a?s=e.positionArray()[a]+(l+1)*t:0===a&&(n=e.positionArray()[a]+(l+1)*t);var o="".concat(n,"-").concat(s),i=document.getElementById("".concat(o));if(null==i)break;if(0==l&&(i.classList.contains("playerOne")||i.classList.contains("playerTwo"))){fightMode();break}if(i.classList.contains("playerOne")||i.classList.contains("playerTwo"))break;if(i.classList.contains("dimmedSquare"))break;i.classList.add("availableSquare")}}a(e,0,-1),a(e,0,1),a(e,1,-1),a(e,1,1)}function takePlayerAway(e){document.getElementById(e.position.id).classList.remove(e.cssClass)}function clearAccessible(){for(;availableList.length;)availableList[availableList.length-1].classList.remove("availableSquare")}function movePlayer(e){clearAccessible(),takePlayerAway(e);var t=document.getElementById(event.target.id);t.classList.add(e.cssClass),e.position=t;for(var a=function(a){t.classList.contains("".concat(weapons[a].cssClass))&&(console.log("grabbed ".concat(weapons[a].cssClass)),t.classList.add("".concat(e.Weapon.cssClass)),e.Weapon=weapons.find(function(e){return n=a,e.cssClass==weapons[a].cssClass}),t.classList.remove("".concat(weapons[a].cssClass)),a=weapons.length),n=a},n=0;n<weapons.length;n++)a(n);activePlayer()==playerOne?(playerOne.isActive=!1,playerTwo.isActive=!0):activePlayer()==playerTwo&&(playerTwo.isActive=!1,playerOne.isActive=!0),document.getElementById("".concat(e.statboxId)).innerHTML="",statboxFunction(e),checkAvailableSquares(activePlayer())}function fightMode(){mapGrid.classList.add("disabled");var e="";activePlayer()==playerOne?e=document.getElementsByClassName("btnBox")[0]:activePlayer()==playerTwo&&(e=document.getElementsByClassName("btnBox")[1]),e.style.display="block"}function attackPlayer(){if(activePlayer()==playerOne){playerTwo.healthPoints=playerTwo.healthPoints-playerOne.Weapon.damage*playerTwo.defence,document.getElementById("".concat(playerTwo.statboxId)).innerHTML="",statboxFunction(playerTwo),playerTwo.defence=1;var e=document.getElementsByClassName("btnBox")[0];e.style.display="none",(e=document.getElementsByClassName("btnBox")[1]).style.display="block",playerOne.isActive=!1,playerTwo.isActive=!0}else if(activePlayer()==playerTwo){playerOne.healthPoints=playerOne.healthPoints-playerTwo.Weapon.damage*playerOne.defence,document.getElementById("".concat(playerOne.statboxId)).innerHTML="",statboxFunction(playerOne),playerOne.defence=1;var a=document.getElementsByClassName("btnBox")[1];a.style.display="none",(a=document.getElementsByClassName("btnBox")[0]).style.display="block",playerTwo.isActive=!1,playerOne.isActive=!0}(playerOne.healthPoints<=0||playerTwo.healthPoints<=0)&&alert("game over!")}function defendPlayer(){if(activePlayer()==playerOne){playerOne.defence=.5;var e=document.getElementsByClassName("btnBox")[0];e.style.display="none",(e=document.getElementsByClassName("btnBox")[1]).style.display="block",playerOne.isActive=!1,playerTwo.isActive=!0}else if(activePlayer()==playerTwo){playerTwo.defence=.5;var a=document.getElementsByClassName("btnBox")[1];a.style.display="none",(a=document.getElementsByClassName("btnBox")[0]).style.display="block",playerTwo.isActive=!1,playerOne.isActive=!0}}var body=document.querySelector("body");body.addEventListener("click",function(e){e.target.classList.contains("availableSquare")?movePlayer(activePlayer()):e.target.classList.contains("attackBtn")?attackPlayer():e.target.classList.contains("defendBtn")&&defendPlayer()});